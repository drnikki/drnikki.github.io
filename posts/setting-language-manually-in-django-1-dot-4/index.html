<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting Language manually in Django 1.4 | Dr. Nikki Stevens</title>
<meta name=keywords content><meta name=description content="I spent today debugging a multilingual django app that I didn&rsquo;t write.  The problem is that the site&rsquo;s language was being changed when you used the language switcher, but not if you typed in the url.  So http://example.com/fr would only occasionally land you on the French version of the site. When you&rsquo;re using custom language codes for any reason (in our case, we were matching the client&rsquo;s lang codes) you&rsquo;re going to have to set the app&rsquo;s language."><meta name=author content="Dr. Nikki Stevens"><link rel=canonical href=https://nikkistevens.com/posts/setting-language-manually-in-django-1-dot-4/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://nikkistevens.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://nikkistevens.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://nikkistevens.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://nikkistevens.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://nikkistevens.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://nikkistevens.com/posts/setting-language-manually-in-django-1-dot-4/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Setting Language manually in Django 1.4"><meta property="og:description" content="I spent today debugging a multilingual django app that I didn&rsquo;t write.  The problem is that the site&rsquo;s language was being changed when you used the language switcher, but not if you typed in the url.  So http://example.com/fr would only occasionally land you on the French version of the site. When you&rsquo;re using custom language codes for any reason (in our case, we were matching the client&rsquo;s lang codes) you&rsquo;re going to have to set the app&rsquo;s language."><meta property="og:type" content="article"><meta property="og:url" content="https://nikkistevens.com/posts/setting-language-manually-in-django-1-dot-4/"><meta property="og:image" content="https://nikkistevens.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-10-15T00:00:00+00:00"><meta property="article:modified_time" content="2012-10-15T00:00:00+00:00"><meta property="og:site_name" content="Dr. Nikki Stevens"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nikkistevens.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Setting Language manually in Django 1.4"><meta name=twitter:description content="I spent today debugging a multilingual django app that I didn&rsquo;t write.  The problem is that the site&rsquo;s language was being changed when you used the language switcher, but not if you typed in the url.  So http://example.com/fr would only occasionally land you on the French version of the site. When you&rsquo;re using custom language codes for any reason (in our case, we were matching the client&rsquo;s lang codes) you&rsquo;re going to have to set the app&rsquo;s language."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nikkistevens.com/posts/"},{"@type":"ListItem","position":2,"name":"Setting Language manually in Django 1.4","item":"https://nikkistevens.com/posts/setting-language-manually-in-django-1-dot-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting Language manually in Django 1.4","name":"Setting Language manually in Django 1.4","description":"I spent today debugging a multilingual django app that I didn\u0026rsquo;t write. The problem is that the site\u0026rsquo;s language was being changed when you used the language switcher, but not if you typed in the url. So http://example.com/fr would only occasionally land you on the French version of the site. When you\u0026rsquo;re using custom language codes for any reason (in our case, we were matching the client\u0026rsquo;s lang codes) you\u0026rsquo;re going to have to set the app\u0026rsquo;s language.\n","keywords":[],"articleBody":"I spent today debugging a multilingual django app that I didn’t write. The problem is that the site’s language was being changed when you used the language switcher, but not if you typed in the url. So http://example.com/fr would only occasionally land you on the French version of the site. When you’re using custom language codes for any reason (in our case, we were matching the client’s lang codes) you’re going to have to set the app’s language.\nThe relevant code:\ndef manual_language_function(request, lang): if hasattr(request, 'session'): request.session['django_language'] = lang else: # do something else Because setting the session isn’t enough, you’ve got to add:\ntranslation.activate(lang) And the whole thing for completeness’s sake\ndef manual_language_function(request, lang): if hasattr(request, 'session'): request.session['django_language'] = lang translation.activate(lang) else: # do something else I lost a few hours figuring this out today, so here you go.\n","wordCount":"141","inLanguage":"en","datePublished":"2012-10-15T00:00:00Z","dateModified":"2012-10-15T00:00:00Z","author":{"@type":"Person","name":"Dr. Nikki Stevens"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nikkistevens.com/posts/setting-language-manually-in-django-1-dot-4/"},"publisher":{"@type":"Organization","name":"Dr. Nikki Stevens","logo":{"@type":"ImageObject","url":"https://nikkistevens.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nikkistevens.com/ accesskey=h title="Dr. Nikki Stevens (Alt + H)"><img src=https://nikkistevens.com/apple-touch-icon.png alt aria-label=logo height=35>Dr. Nikki Stevens</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://nikkistevens.com/about/ title=About><span>About</span></a></li><li><a href=https://nikkistevens.com/research/ title=Research><span>Research</span></a></li><li><a href=https://nikkistevens.com/open-source/ title="Open Source"><span>Open Source</span></a></li><li><a href=https://nikkistevens.com/posts/ title=Blog><span>Blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nikkistevens.com/>Home</a>&nbsp;»&nbsp;<a href=https://nikkistevens.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Setting Language manually in Django 1.4</h1><div class=post-meta><span title='2012-10-15 00:00:00 +0000 UTC'>October 15, 2012</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;141 words&nbsp;·&nbsp;Dr. Nikki Stevens</div></header><div class=post-content><p>I spent today debugging a multilingual django app that I didn&rsquo;t write. The problem is that the site&rsquo;s language was being changed when you used the language switcher, but not if you typed in the url. So <a href=http://example.com/fr>http://example.com/fr</a> would only <em>occasionally</em> land you on the French version of the site. When you&rsquo;re using custom language codes for any reason (in our case, we were matching the client&rsquo;s lang codes) you&rsquo;re going to have to set the app&rsquo;s language.</p><p>The relevant code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>manual_language_function</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>lang</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s1>&#39;session&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>request</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;django_language&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>lang</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># do something else</span>
</span></span></code></pre></div><p>Because setting the session isn&rsquo;t enough, you&rsquo;ve got to add:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>        <span class=n>translation</span><span class=o>.</span><span class=n>activate</span><span class=p>(</span><span class=n>lang</span><span class=p>)</span>
</span></span></code></pre></div><p>And the whole thing for completeness&rsquo;s sake</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>manual_language_function</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=n>lang</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>request</span><span class=p>,</span> <span class=s1>&#39;session&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;django_language&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>lang</span>
</span></span><span class=line><span class=cl>        <span class=n>translation</span><span class=o>.</span><span class=n>activate</span><span class=p>(</span><span class=n>lang</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># do something else</span>
</span></span></code></pre></div><p>I lost a few hours figuring this out today, so here you go.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><iframe width=540 height=405 src=https://1a058c67.sibforms.com/serve/MUIFAOaOgw-TPpQUNS1YvGcyubxS7qxJ_b3LDaS50tOWJFAbfMIpKsU81fcT3zxSv82FtAa0x_kd_NoZq_gMzEmy1RLrdXxUK98l9jL1QkzDjZMQfIynHJ6q3ebzvwqXsIMreuEnb6Y1vF8nMQduGMgmxx9NpbEe0G2X6sjmmo3cvS1Qv03-ZhU_z22_UgZ6kqQNAtuljoqL_F_z frameborder=0 scrolling=no allowfullscreen style=display:block;margin-left:auto;margin-right:auto;max-width:100%></iframe>
<span>&copy; 2024 <a href=https://nikkistevens.com/>Dr. Nikki Stevens</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>